<div [hidden]="edit" class="container-fluid pb-5">
  <div class="page-toolbar">
    <div>
      <h2 class="page-title">Prestamos</h2>
      <div class="page-subtitle">Control de prestamos, devoluciones y renovaciones.</div>
    </div>
    <div class="input-group page-search">
      <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
      <input [(ngModel)]="searchField" name="searchField" (blur)="search()" (keydown)="keytab($event)" type="text"
        class="form-control" placeholder="Buscar">
      <button class="btn btn-success" type="button" (click)="nuevo()"><i class="fa fa-plus-circle"
          aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="row g-4 page-grid">
    <div class="form-group col-12 col-sm-6" *ngFor="let prestamo of prestamos | bibliotecaSearch: searchField">
      <div class="card h-100">
        <div class="card-body">
          <h4 class="card-title">{{ prestamo.titulo }}</h4>
          Usuario: {{ prestamo.usuario }} Â· Vence: {{ prestamo.fechaVencimiento }}<br />
          Estado: {{ prestamo.estado | titlecase }}
          <div class="mt-2">
            <button class="btn btn-link btn-sm" (click)="renovar(prestamo)" [disabled]="prestamo.estado !== 'activo'">Renovar</button>
            <button class="btn btn-link btn-sm text-danger" (click)="devolver(prestamo)" [disabled]="prestamo.estado === 'devuelto'">Devolver</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div [hidden]="!edit" class="container-fluid pb-5">
  <h2>Prestamo</h2>
  <form class="page-form">
    <div class="page-form-card">
      <h5>Nuevo prestamo</h5>
      <div class="row g-2">
        <div class="col-md-5">
          <label class="form-label">Ejemplar</label>
          <select class="form-select" [(ngModel)]="nuevoPrestamo.ejemplarId" name="ejemplarId">
            <option [ngValue]="0">Seleccione...</option>
            <option *ngFor="let ejemplar of ejemplares" [ngValue]="ejemplar.id">
              {{ ejemplar.libroTitulo || ejemplar.libroId }} - {{ ejemplar.codigoBarra || ejemplar.id }}
            </option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Usuario</label>
          <select class="form-select" [(ngModel)]="nuevoPrestamo.usuarioId" name="usuarioId">
            <option [ngValue]="0">Seleccione...</option>
            <option *ngFor="let usuario of usuarios" [ngValue]="usuario.id">{{ usuario.nombre }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Vence</label>
          <input type="date" class="form-control" [(ngModel)]="nuevoPrestamo.fechaVencimiento" name="fechaVencimiento" />
        </div>
        <div class="col-12">
          <div class="page-actions d-flex justify-content-end gap-2">
            <button class="btn btn-success" type="button" (click)="crearPrestamo()">Registrar</button>
            <button class="btn btn-danger" type="button" (click)="cancelar()">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
