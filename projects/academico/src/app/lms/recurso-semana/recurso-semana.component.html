<div class="card mt-3 border-0 shadow-sm">
  <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-2">
    <h6 class="mb-0">
      <i class="fa fa-folder-open mr-2"></i>Recursos registrados
    </h6>
    <button class="btn btn-light btn-sm" (click)="abrirNuevo()">
      <i class="fa fa-plus mr-1"></i> Nuevo recurso
    </button>
  </div>
  
  <div class="card-body p-0">
    <div *ngIf="Recursos.length > 0; else noData" class="list-group list-group-flush">
      <div *ngFor="let r of Recursos" class="list-group-item border-0 py-3">
        <div class="d-flex align-items-start">
          <!-- Icono según tipo -->
          <!-- Contenedor del icono (mantenemos las clases de color) -->
          <div class="mr-3">
            <div class="resource-icon" [ngClass]="{
              'text-resource': r.Tipo === '1',
              'link-resource': r.Tipo === '2',
              'video-resource': r.Tipo === '3',
              'pdf-resource': r.Tipo === '4',
              'pres-resource': r.Tipo === '5'
            }">
              <!-- Icono con clases de color explícitas -->
              <i class="fa" [ngClass]="{
                'fa-file-text text-primary': r.Tipo === '1',
                'fa-link text-success': r.Tipo === '2',
                'fa-video text-danger': r.Tipo === '3',
                'fa-file-pdf-o': r.Tipo === '4',
                'fa-file-powerpoint-o text-warning': r.Tipo === '5'
              }"></i>
            </div>
          </div>
          
          <!-- Contenido principal -->
          <div class="flex-grow-1">
            <div class="d-flex  align-items-center mb-2">
              <span class="resource-type pr-2">{{ getTipoText(r.Tipo) }}</span>
              <h6 class="resource-title mb-0">{{ r.Titulo }}</h6>
            </div>
            
            <div class="resource-content">
              <ng-container [ngSwitch]="r.Tipo">
                <a *ngSwitchCase="'2'" [href]="r.URL" target="_blank" class="text-truncate d-block">{{ r.URL }}</a>
                <a *ngSwitchCase="'4'" [href]="r.URL" target="_blank" class="text-truncate d-block">Descargar PDF</a>
                <a *ngSwitchCase="'5'" [href]="r.URL" target="_blank" class="text-truncate d-block">Ver presentación</a>
                <a *ngSwitchCase="'3'" [href]="r.URL" target="_blank" class="text-truncate d-flex align-items-center">
                <i class="fas fa-video text-danger mr-2"></i> {{ r.Nombre || 'Ver video' }}
              </a>
                <div *ngSwitchCase="'1'" [innerHTML]="r.Contenido | slice:0:200" class="text-muted"></div>
              </ng-container>
            </div>
          </div>
          
          <!-- Acciones -->
          <div class="d-flex">
            <button class="btn btn-sm btn-outline-secondary mr-1" (click)="editar(r)">
              <i class="fa fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="eliminar(r)">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <ng-template #noData>
      <div class="empty-state p-4 text-center text-muted">
        <i class="fa fa-inbox fa-2x mb-2"></i>
        <p class="mb-0">No hay recursos registrados para esta semana.</p>
      </div>
    </ng-template>
  </div>
</div>

<!-- MODAL (Estilo Teams) -->
<div class="modal-backdrop fade show" *ngIf="edit" (click)="cancelar()"></div>
<div class="modal fade show d-block" *ngIf="edit" tabindex="-1" aria-modal="true" role="dialog">
  <div class="modal-dialog" [ngClass]="{ 'modal-lg': Recurso.Tipo === '1' }">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white py-2">
        <h5 class="modal-title">{{ Recurso.Id_Recurso ? 'Editar' : 'Nuevo' }} Recurso</h5>
        <button type="button" class="close text-white" (click)="cancelar()">&times;</button>
      </div>
      
      <div class="modal-body">
        <form>
          <div class="form-row">
            <div class="form-group col-md-8">
              <label class="font-weight-bold">Título</label>
              <input type="text" class="form-control" [(ngModel)]="Recurso.Titulo" name="Titulo">
            </div>
            
            <div class="form-group col-md-4">
              <label class="font-weight-bold">Tipo</label>
              <select class="form-control" [(ngModel)]="Recurso.Tipo" name="Tipo">
                <option value="1">Texto</option>
                <option value="2">Enlace</option>
                <option value="3">Video</option>
                <option value="4">PDF</option>
                <option value="5">Presentación</option>
              </select>
            </div>
          </div>
          
          <!-- Contenido según tipo -->
          <div class="border-top mt-3 pt-3">
            <label class="font-weight-bold">Contenido</label>
            
            <!-- RichTextEditor para Texto -->
            <div *ngIf="Recurso.Tipo === '1'">
              <ejs-richtexteditor height="300px" (change)="onCongenidoChange($event)"  [(value)]="Recurso.Contenido" [toolbarSettings]="{ enable: true }"></ejs-richtexteditor>
            </div>
            
            <!-- URL para Link o YouTube -->
            <div *ngIf="Recurso.Tipo === '2' || Recurso.Tipo === '3'">
              <input type="text" class="form-control mt-2" [(ngModel)]="Recurso.URL" name="URL" placeholder="https://...">
            </div>
            
            <!-- Subida de archivos -->
            <div *ngIf="Recurso.Tipo === '4' || Recurso.Tipo === '5'">
              <div class="custom-file mt-2">
                <input type="file" class="custom-file-input" id="resourceFile" (change)="handleFileInput($event)">
                <label class="custom-file-label" for="resourceFile">
                  {{ fileToUpload?.name || 'Seleccionar archivo' }}
                </label>
              </div>
              <small class="form-text text-muted">Formatos: PDF para documentos, PPT/PPTX para presentaciones</small>
              
              <div *ngIf="Recurso.URL && !fileToUpload" class="mt-2">
                <div class="d-flex align-items-center p-2 bg-light rounded">
                  <i class="fa fa-file-pdf-o text-danger fa-2x mr-2" *ngIf="Recurso.Tipo === '4'"></i>
                  <i class="fa fa-file-powerpoint-o text-warning fa-2x mr-2" *ngIf="Recurso.Tipo === '5'"></i>
                  <div class="flex-grow-1">
                    <a [href]="Recurso.URL" target="_blank" class="font-weight-bold">Archivo adjunto actual</a>
                    <div class="small text-muted">Haga clic para descargar</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-footer bg-light">
        <button class="btn btn-primary" (click)="grabar()">
          <i class="fa fa-save mr-1"></i> {{ Recurso.Id_Recurso ? 'Actualizar' : 'Crear' }}
        </button>
        <button class="btn btn-outline-secondary" (click)="cancelar()">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>